"0","#put thresholds here"
"0","best_thresholds <- c(""0"" = 0.89, ""1"" = 0.09, ""2"" = 0.04)     ##################CHANGE THRESHOLDS HEEEEER"
"0",""
"0","#apply threshold"
"0","thresholded_preds <- sapply(class_labels, function(cls) {"
"0","  probs <- pred_probs_calib[, as.character(cls)]"
"0","  as.integer(probs >= best_thresholds[as.character(cls)])"
"0","})"
"0",""
"0","# pick highest probability"
"0","pred_classes_thresh <- apply(thresholded_preds, 1, function(row) {"
"0","  if (sum(row) == 0) {"
"0","    return(NA)  "
"0","  } else if (sum(row) == 1) {"
"0","    return(which(row == 1) - 1)  "
"0","  } else {"
"0","    return(which.max(pred_probs_calib[row == 1, ][1, ]) - 1)"
"0","  }"
"0","})"
"0",""
"0","# if NA use argmax"
"0","na_indices <- is.na(pred_classes_thresh)"
"0","if (any(na_indices)) {"
"0","  fallback_preds <- max.col(pred_probs_calib[na_indices, ]) - 1"
"0","  pred_classes_thresh[na_indices] <- fallback_preds"
"0","}"
"0",""
"0","y_pred_calib_thresh <- factor(pred_classes_thresh, levels = class_labels)"
"0","y_true_calib <- factor(y_calib, levels = class_labels)"
"0",""
"0","conf_matrix_thresh <- confusionMatrix(y_pred_calib_thresh, y_true_calib)"
"0","print(conf_matrix_thresh)"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   0"
"1","   1"
"1","   2"
"1","
         0"
"1"," 820"
"1","  20"
"1","   2"
"1","
         1"
"1","  74"
"1","   4"
"1","   0"
"1","
         2"
"1","  19"
"1","   0"
"1","   0"
"1","
"
"1","
Overall Statistics
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.8775          "
"1","
"
"1","                 95% CI :"
"1"," (0.8548, 0.8978)"
"1","
"
"1","    No Information Rate :"
"1"," 0.9723          "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," 1               "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," 0.0277          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," NA              "
"1","
"
"1","
Statistics by Class:

"
"1","                    "
"1"," Class: 0"
"1"," Class: 1"
"1"," Class: 2"
"1","
Sensitivity         "
"1","  0.89814"
"1","  0.16667"
"1","  0.00000"
"1","
Specificity         "
"1","  0.15385"
"1","  0.91913"
"1","  0.97972"
"1","
Pos Pred Value      "
"1","  0.97387"
"1","  0.05128"
"1","  0.00000"
"1","
Neg Pred Value      "
"1","  0.04124"
"1","  0.97677"
"1","  0.99783"
"1","
Prevalence          "
"1","  0.97231"
"1","  0.02556"
"1","  0.00213"
"1","
Detection Rate      "
"1","  0.87327"
"1","  0.00426"
"1","  0.00000"
"1","
Detection Prevalence"
"1","  0.89670"
"1","  0.08307"
"1","  0.02023"
"1","
Balanced Accuracy   "
"1","  0.52599"
"1","  0.54290"
"1","  0.48986"
"1","
"
