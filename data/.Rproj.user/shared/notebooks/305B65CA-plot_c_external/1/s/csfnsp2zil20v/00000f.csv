"0","#put thresholds here"
"0","best_thresholds <- c(""0"" = 0.89, ""1"" = 0.09, ""2"" = 0.04)     ##################CHANGE THRESHOLDS HEEEEER"
"0",""
"0","#apply threshold"
"0","thresholded_preds <- sapply(class_labels, function(cls) {"
"0","  probs <- pred_probs_calib[, as.character(cls)]"
"0","  as.integer(probs >= best_thresholds[as.character(cls)])"
"0","})"
"0",""
"0","# pick highest probability"
"0","pred_classes_thresh <- apply(thresholded_preds, 1, function(row) {"
"0","  if (sum(row) == 0) {"
"0","    return(NA)  "
"0","  } else if (sum(row) == 1) {"
"0","    return(which(row == 1) - 1)  "
"0","  } else {"
"0","    return(which.max(pred_probs_calib[row == 1, ][1, ]) - 1)"
"0","  }"
"0","})"
"0",""
"0","# if NA use argmax"
"0","na_indices <- is.na(pred_classes_thresh)"
"0","if (any(na_indices)) {"
"0","  fallback_preds <- max.col(pred_probs_calib[na_indices, ]) - 1"
"0","  pred_classes_thresh[na_indices] <- fallback_preds"
"0","}"
"0",""
"0","y_pred_calib_thresh <- factor(pred_classes_thresh, levels = class_labels)"
"0","y_true_calib <- factor(y_calib, levels = class_labels)"
"0",""
"0","conf_matrix_thresh <- confusionMatrix(y_pred_calib_thresh, y_true_calib)"
"0","print(conf_matrix_thresh)"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   0"
"1","   1"
"1","   2"
"1","
         0"
"1"," 941"
"1","  12"
"1","   4"
"1","
         1"
"1","   6"
"1","   0"
"1","   0"
"1","
         2"
"1","   6"
"1","   0"
"1","   0"
"1","
"
"1","
Overall Statistics
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.9711          "
"1","
"
"1","                 95% CI :"
"1"," (0.9585, 0.9807)"
"1","
"
"1","    No Information Rate :"
"1"," 0.9835          "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," 0.998           "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," -0.0107         "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," NA              "
"1","
"
"1","
Statistics by Class:

"
"1","                    "
"1"," Class: 0"
"1"," Class: 1"
"1"," Class: 2"
"1","
Sensitivity         "
"1","   0.9874"
"1"," 0.000000"
"1"," 0.000000"
"1","
Specificity         "
"1","   0.0000"
"1"," 0.993730"
"1"," 0.993782"
"1","
Pos Pred Value      "
"1","   0.9833"
"1"," 0.000000"
"1"," 0.000000"
"1","
Neg Pred Value      "
"1","   0.0000"
"1"," 0.987539"
"1"," 0.995846"
"1","
Prevalence          "
"1","   0.9835"
"1"," 0.012384"
"1"," 0.004128"
"1","
Detection Rate      "
"1","   0.9711"
"1"," 0.000000"
"1"," 0.000000"
"1","
Detection Prevalence"
"1","   0.9876"
"1"," 0.006192"
"1"," 0.006192"
"1","
Balanced Accuracy   "
"1","   0.4937"
"1"," 0.496865"
"1"," 0.496891"
"1","
"
