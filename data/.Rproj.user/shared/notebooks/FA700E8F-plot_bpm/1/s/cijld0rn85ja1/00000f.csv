"0",""
"0","# manual thresholds (corresponding to class labels 0, 1, 2)"
"0","best_thresholds <- c(""0"" = 0.83, ""1"" = 0.02, ""2"" = 0.02)     ##################CHANGE THRESHOLDS HEEEEER"
"0","#apply"
"0","thresholded_preds <- sapply(class_labels, function(cls) {"
"0","  probs <- pred_probs_calib[, as.character(cls)]"
"0","  as.integer(probs >= best_thresholds[as.character(cls)])"
"0","})"
"0",""
"0","pred_classes_thresh <- apply(thresholded_preds, 1, function(row) {"
"0","  if (sum(row) == 0) {"
"0","    return(NA)  # No threshold passed"
"0","  } else if (sum(row) == 1) {"
"0","    return(which(row == 1) - 1)  # single class passed threshold"
"0","  } else {"
"0","    # Multiple thresholds passed: pick one with max probability"
"0","    return(which.max(pred_probs_calib[row == 1, ][1, ]) - 1)"
"0","  }"
"0","})"
"0",""
"0","# if NA use argmax "
"0","na_indices <- is.na(pred_classes_thresh)"
"0","if (any(na_indices)) {"
"0","  fallback_preds <- max.col(pred_probs_calib[na_indices, ]) - 1"
"0","  pred_classes_thresh[na_indices] <- fallback_preds"
"0","}"
"0",""
"0","y_pred_calib_thresh <- factor(pred_classes_thresh, levels = class_labels)"
"0","y_true_calib <- factor(y_calib, levels = class_labels)"
"0",""
"0","# evaluate"
"0","conf_matrix_thresh <- confusionMatrix(y_pred_calib_thresh, y_true_calib)"
"0","print(conf_matrix_thresh)"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   0"
"1","   1"
"1","   2"
"1","
         0"
"1"," 893"
"1","  47"
"1","  17"
"1","
         1"
"1","  12"
"1","   0"
"1","   0"
"1","
         2"
"1","   0"
"1","   0"
"1","   0"
"1","
"
"1","
Overall Statistics
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.9216          "
"1","
"
"1","                 95% CI :"
"1"," (0.9028, 0.9377)"
"1","
"
"1","    No Information Rate :"
"1"," 0.934           "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," 0.944           "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," -0.0184         "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," NA              "
"1","
"
"1","
Statistics by Class:

"
"1","                    "
"1"," Class: 0"
"1"," Class: 1"
"1"," Class: 2"
"1","
Sensitivity         "
"1","   0.9867"
"1","  0.00000"
"1","  0.00000"
"1","
Specificity         "
"1","   0.0000"
"1","  0.98698"
"1","  1.00000"
"1","
Pos Pred Value      "
"1","   0.9331"
"1","  0.00000"
"1","      NaN"
"1","
Neg Pred Value      "
"1","   0.0000"
"1","  0.95089"
"1","  0.98246"
"1","
Prevalence          "
"1","   0.9340"
"1","  0.04850"
"1","  0.01754"
"1","
Detection Rate      "
"1","   0.9216"
"1","  0.00000"
"1","  0.00000"
"1","
Detection Prevalence"
"1","   0.9876"
"1","  0.01238"
"1","  0.00000"
"1","
Balanced Accuracy   "
"1","   0.4934"
"1","  0.49349"
"1","  0.50000"
"1","
"
