"0",""
"0","library(dplyr)"
"0","library(tidyr)"
"0","library(ggplot2)"
"0","library(stringr)"
"0",""
"0","# Add 'set' column to each"
"0","train_data <- train_data %>% mutate(set = ""Train"")"
"0","test_data  <- test_data  %>% mutate(set = ""Test"")"
"0",""
"0","# Combine"
"0","combined_data <- bind_rows(train_data, test_data)"
"0",""
"0","# Reshape to long format"
"0","long_split <- combined_data %>%"
"0","  select(set, cbcl_scr_syn_internal_t, bpm_y_scr_internal_t) %>%"
"0","  pivot_longer(cols = -set, names_to = ""variable"", values_to = ""value"") %>%"
"0","  mutate(variable = recode(variable,"
"0","                           ""cbcl_scr_syn_internal_t"" = ""Parent-Reported"","
"0","                           ""bpm_y_scr_internal_t""    = ""Youth-Reported"""
"0","  ))"
"0",""
"0","# Function to calculate density and get max y-value"
"0","calculate_density_and_max <- function(data) {"
"0","  dens <- density(data$value, na.rm = TRUE)"
"0","  return(max(dens$y))"
"0","}"
"0",""
"0","# Calculate global max density across all variable + set combinations"
"0","max_density <- long_split %>%"
"0","  group_by(variable, set) %>%"
"0","  summarise(max_density = calculate_density_and_max(cur_data()), .groups = ""drop"") %>%"
"0","  summarise(global_max = max(max_density)) %>%"
"0","  pull(global_max)"
"2","Warning: [38;5;246mThere was 1 warning in `summarise()`.[39m
[38;5;246m[36mâ„¹[38;5;246m In argument: `max_density = calculate_density_and_max(cur_data())`.
[36mâ„¹[38;5;246m In group 1: `variable = ""Parent-Reported""` and `set = ""Test""`.[39m
Caused by warning:
[38;5;246m[33m![38;5;246m `cur_data()` was deprecated in dplyr 1.1.0.
[36mâ„¹[38;5;246m Please use `pick()` instead.
[90mThis warning is displayed once every 8 hours.[38;5;246m
[90mCall `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.[38;5;246m[39m"
"0","# Final Plot"
"0","ggplot(long_split, aes(x = value, fill = set)) +"
"0","  geom_histogram(aes(y = ..density..), bins = 30, color = ""black"", alpha = 0.3, position = ""identity"") +"
"0","  geom_density(alpha = 0.4, size = 1) +"
"0","  facet_wrap(~ variable, scales = ""fixed"") +"
"0","  scale_fill_manual(values = c(""Train"" = ""#377eb8"", ""Test"" = ""#e41a1c"")) +"
"0","  coord_cartesian(xlim = c(-2, 5), ylim = c(0, max_density)) +"
"0","  labs(title = ""Train vs Test Distributions of Outcome Variables"","
"0","       x = ""Standardized Scores"","
"0","       y = ""Density"","
"0","       fill = ""Dataset"") +"
"0","  theme_classic(base_size = 18) +"
"0","  theme("
"0","    legend.position = ""top"","
"0","    strip.text = element_text(face = ""bold"", size = 11),"
"0","    strip.background = element_blank(),  # <<-- removes grey boxes"
"0","    plot.title = element_text(face = ""bold"", hjust = 0.5)"
"0","  )"
