"0","#put thresholds here"
"0","best_thresholds <- c(""0"" = 0.89, ""1"" = 0.09, ""2"" = 0.04)     ##################CHANGE THRESHOLDS HEEEEER"
"0",""
"0","#apply threshold"
"0","thresholded_preds <- sapply(class_labels, function(cls) {"
"0","  probs <- pred_probs_calib[, as.character(cls)]"
"0","  as.integer(probs >= best_thresholds[as.character(cls)])"
"0","})"
"0",""
"0","# pick highest probability"
"0","pred_classes_thresh <- apply(thresholded_preds, 1, function(row) {"
"0","  if (sum(row) == 0) {"
"0","    return(NA)  "
"0","  } else if (sum(row) == 1) {"
"0","    return(which(row == 1) - 1)  "
"0","  } else {"
"0","    return(which.max(pred_probs_calib[row == 1, ][1, ]) - 1)"
"0","  }"
"0","})"
"0",""
"0","# if NA use argmax"
"0","na_indices <- is.na(pred_classes_thresh)"
"0","if (any(na_indices)) {"
"0","  fallback_preds <- max.col(pred_probs_calib[na_indices, ]) - 1"
"0","  pred_classes_thresh[na_indices] <- fallback_preds"
"0","}"
"0",""
"0","y_pred_calib_thresh <- factor(pred_classes_thresh, levels = class_labels)"
"0","y_true_calib <- factor(y_calib, levels = class_labels)"
"0",""
"0","conf_matrix_thresh <- confusionMatrix(y_pred_calib_thresh, y_true_calib)"
"0","print(conf_matrix_thresh)"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   0"
"1","   1"
"1","   2"
"1","
         0"
"1"," 663"
"1","  19"
"1","   8"
"1","
         1"
"1"," 133"
"1","   7"
"1","   6"
"1","
         2"
"1"," 126"
"1","   2"
"1","   5"
"1","
"
"1","
Overall Statistics
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.6966          "
"1","
"
"1","                 95% CI :"
"1"," (0.6666, 0.7254)"
"1","
"
"1","    No Information Rate :"
"1"," 0.9515          "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," 1               "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," 0.0381          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," <2e-16          "
"1","
"
"1","
Statistics by Class:

"
"1","                    "
"1"," Class: 0"
"1"," Class: 1"
"1"," Class: 2"
"1","
Sensitivity         "
"1","  0.71909"
"1"," 0.250000"
"1","  0.26316"
"1","
Specificity         "
"1","  0.42553"
"1"," 0.852285"
"1","  0.86526"
"1","
Pos Pred Value      "
"1","  0.96087"
"1"," 0.047945"
"1","  0.03759"
"1","
Neg Pred Value      "
"1","  0.07168"
"1"," 0.974484"
"1","  0.98325"
"1","
Prevalence          "
"1","  0.95150"
"1"," 0.028896"
"1","  0.01961"
"1","
Detection Rate      "
"1","  0.68421"
"1"," 0.007224"
"1","  0.00516"
"1","
Detection Prevalence"
"1","  0.71207"
"1"," 0.150671"
"1","  0.13725"
"1","
Balanced Accuracy   "
"1","  0.57231"
"1"," 0.551142"
"1","  0.56421"
"1","
"
